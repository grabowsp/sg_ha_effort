# Analysis of polyploid genotypes generated by Sujan

## Location of files
### Raw VCF's (genotype calls, no read counts)
* Sujan's directory with VCF's
  * `/global/projectb/scratch/sujan/Pvirgatum_polyploid/`
* My directory
  * `/global/cscratch1/sd/grabowsp/sg_ploidy/polyploid_vcfs`
### Files to help process VCFs
* BED Files
  * CDS BED
    * `/global/cscratch1/sd/grabowsp/sg_ploidy/genic_positions/sg_v5_CDS.bed`
  * Genes BED
    * `/global/cscratch1/sd/grabowsp/sg_ploidy/genic_positions/sg_v5_genes.bed`
* Library names by Ploidy Call
  * `/global/cscratch1/sd/grabowsp/sg_ploidy/tetraploid_lib_names_May2020.txt`
  * `/global/cscratch1/sd/grabowsp/sg_ploidy/octoploid_lib_names_May2020.txt`
* Name of all "Good" Libaries
  * `/global/cscratch1/sd/grabowsp/sg_ploidy/samp901_lib_names.txt`
### Filtered VCF Directories
* CDS VCFs
  `/global/cscratch1/sd/grabowsp/sg_ploidy/polyploid_vcfs/CDS_vcfs`
* CDS VCFs with 901 "good" samples
  `/global/cscratch1/sd/grabowsp/sg_ploidy/polyploid_vcfs/CDS_vcfs/all_samps`


## Generate CDS VCFs for each chromosome
```
cd /global/cscratch1/sd/grabowsp/sg_ploidy/polyploid_vcfs
sbatch generate_Chr01K_N_CDS_vcfs.sh

gunzip -kc Chr01K.polyploid.CDS.vcf.gz | head 

sbatch generate_Chr02to05_CDS_vcfs.sh
sbatch generate_Chr06to09_CDS_vcfs.sh
```
* Moved to `/global/cscratch1/sd/grabowsp/sg_ploidy/polyploid_vcfs/CDS_vcfs`

## Filter CDS VCF for included samples
```
module load python/3.7-anaconda-2019.07
source activate gen_bioinformatics

cd /global/cscratch1/sd/grabowsp/sg_ploidy/polyploid_vcfs/CDS_vcfs/all_samps

sbatch generate_Chr01K_01N_CDS_allsamp_vcf.sh
sbatch generate_Chr02_05_CDS_allsamp_vcf.sh
sbatch generate_Chr06_09_CDS_allsamp_vcf.sh
```

## Split vcfs into 100k-line files
### Chr01K Files with different levels of missing data
```
cd /global/cscratch1/sd/grabowsp/sg_ploidy/polyploid_vcfs/CDS_vcfs/all_samps

gunzip -kc Chr01K.polyploid.CDS.allsamps.vcf.gz | \
split -l 100000 -d - Chr01K.polyploid.CDS.allsamps.vcf_

cd /global/cscratch1/sd/grabowsp/sg_ploidy/polyploid_vcfs/CDS_vcfs/all_samps/few_missing

gunzip -kc Chr01K.polyploid.CDS.allsamps.few_miss.vcf.gz | \
split -l 100000 -d - Chr01K.polyploid.CDS.allsamps.few_miss.vcf_

cd /global/cscratch1/sd/grabowsp/sg_ploidy/polyploid_vcfs/CDS_vcfs/all_samps/half_missing

gunzip -kc Chr01K.polyploid.CDS.allsamps.half_miss.vcf.gz | \
split -l 100000 -d - Chr01K.polyploid.CDS.allsamps.half_miss.vcf_

cd /global/cscratch1/sd/grabowsp/sg_ploidy/polyploid_vcfs/CDS_vcfs/all_samps/high_missing

gunzip -kc Chr01K.polyploid.CDS.allsamps.high_miss.vcf.gz | \
split -l 100000 -d - Chr01K.polyploid.CDS.allsamps.high_miss.vcf_
``` 
### Generate VCF header to be used for `allsamps` VCFs
```
cd /global/cscratch1/sd/grabowsp/sg_ploidy/polyploid_vcfs/CDS_vcfs/all_samps
head -5 Chr01K.polyploid.CDS.allsamps.vcf_00 | tail -1 > \
CDS.allsamps.vcf.header.txt
```

## Filter CDS VCF by missing data
```
cd /global/cscratch1/sd/grabowsp/sg_ploidy/polyploid_vcfs/CDS_vcfs/all_samps

sbatch generate_Chr01_CDS_MissFilt.sh
```

## Generate CDS VCF for natural samples
* maximum 20% missing data
* Samples sets (on Cori):
  * `/global/cscratch1/sd/grabowsp/sg_ploidy/geo826_lib_names.txt`
  * `/global/cscratch1/sd/grabowsp/sg_ploidy/geo_expand_839_lib_names.txt`
  * Description and code here:
    * `~/sg_ha_effort/samp_set_explanations.md`
### Make Climate VCFs
#### No 8X cultivars
```
cd /global/cscratch1/sd/grabowsp/sg_ploidy/polyploid_vcfs/CDS_vcfs/geo_samps

sbatch generate_Chr01K_01N_CDS_geosamps_vcf.sh
sbatch generate_Chr02_Chr05_CDS_geosamps_vcf.sh
sbatch generate_Chr06_Chr09_CDS_geosamps_vcf.sh
```
#### Include 8X cultivars
```
cd /global/cscratch1/sd/grabowsp/sg_ploidy/polyploid_vcfs/CDS_vcfs/expand_geo_samps

sbatch generate_Chr01K_01N_CDS_expandgeosamps_vcf.sh
sbatch generate_Chr02_Chr05_CDS_expandgeosamps_vcf.sh
sbatch generate_Chr06_Chr09_CDS_expandgeosamps_vcf.sh
```

### Divide VCFs
#### Without 8X Cultivars
```
cd /global/cscratch1/sd/grabowsp/sg_ploidy/polyploid_vcfs/CDS_vcfs/geo_samps

gunzip -kc Chr01K.polyploid.CDS.geosamps.vcf.gz | \
split -l 100000 -d - Chr01K.polyploid.CDS.geosamps.vcf_

gunzip -kc Chr01N.polyploid.CDS.geosamps.vcf.gz | \
split -l 100000 -d - Chr01N.polyploid.CDS.geosamps.vcf_

for CN in {02..09};
do
gunzip -kc Chr$CN'K.polyploid.CDS.geosamps.vcf.gz' | \
split -l 100000 -d - Chr$CN'K.polyploid.CDS.geosamps.vcf_';
done

for CN in {02..09};
do
gunzip -kc Chr$CN'N.polyploid.CDS.geosamps.vcf.gz' | \
split -l 100000 -d - Chr$CN'N.polyploid.CDS.geosamps.vcf_';
done


```
#### With 8X Cultivars
```
cd /global/cscratch1/sd/grabowsp/sg_ploidy/polyploid_vcfs/CDS_vcfs/expand_geo_samps

gunzip -kc Chr01K.polyploid.CDS.expandgeosamps.vcf.gz | \
split -l 100000 -d - Chr01K.polyploid.CDS.expandgeosamps.vcf_

gunzip -kc Chr01N.polyploid.CDS.expandgeosamps.vcf.gz | \
split -l 100000 -d - Chr01N.polyploid.CDS.expandgeosamps.vcf_

for CN in {02..09};
do
gunzip -kc Chr$CN'K.polyploid.CDS.expandgeosamps.vcf.gz' | \
split -l 100000 -d - Chr$CN'K.polyploid.CDS.expandgeosamps.vcf_';
done

for CN in {02..09};
do
gunzip -kc Chr$CN'N.polyploid.CDS.expandgeosamps.vcf.gz' | \
split -l 100000 -d - Chr$CN'N.polyploid.CDS.expandgeosamps.vcf_';
done

```
### Generate VCFs headers
#### Without 8X Cultivars
```
cd /global/cscratch1/sd/grabowsp/sg_ploidy/polyploid_vcfs/CDS_vcfs/geo_samps
head -5 Chr01K.polyploid.CDS.geosamps.vcf_00 | tail -1 > \
CDS.geosamps.vcf.header.txt
```
#### With 8X Cultivars
```
cd /global/cscratch1/sd/grabowsp/sg_ploidy/polyploid_vcfs/CDS_vcfs/expand_geo_samps
head -5 Chr01K.polyploid.CDS.expandgeosamps.vcf_00 | tail -1 > \
CDS.expandgeosamps.vcf.header.txt
```


